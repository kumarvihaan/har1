{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "planName": {
            "type": "string",
            "minLength": 1
        },
        "planSKU": {
            "type": "string",
            "allowedValues": [
                "Free",
                "Shared",
                "Basic",
                "Standard"
            ],
            "defaultValue": "Free"
        },
        "planWorkerSize": {
            "type": "string",
            "allowedValues": [
                "0",
                "1",
                "2"
            ],
            "defaultValue": "0"
        },
        "ase": {
			"type": "string"
		},
		"appi": {
			"type": "string"
		},
        "st": {
            "type": "string"
        },
        "stType": {
            "type": "string",
            "defaultValue": "Standard_LRS",
            "allowedValues": [
                "Standard_LRS",
                "Standard_ZRS",
                "Standard_GRS",
                "Standard_RAGRS",
                "Premium_LRS"
            ]
        }
    },
    "resources": [
        {
            "name": "[parameters('PlanName')]",
            "type": "Microsoft.Web/serverfarms",
            "location": "[resourceGroup().location]",
            "apiVersion": "2014-06-01",
            "dependsOn": [],
            "tags": {
                "displayName": "Plan"
            },
            "properties": {
                "name": "[parameters('planName')]",
                "sku": "[parameters('planSKU')]",
                "workerSize": "[parameters('WorkerSize')]",
                "numberOfWorkers": 1
            }
        },
        {
            "name": "[variables('WebappDevelopName')]",
            "type": "Microsoft.Web/sites",
            "location": "[resourceGroup().location]",
            "apiVersion": "2015-08-01",
            "dependsOn": [
                "[concat('Microsoft.Web/serverfarms/', parameters('planName'))]"
            ],
            "tags": {
                "[concat('hidden-related:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('AppServicedevelopName'))]": "Resource",
                "displayName": "WebappDevelop"
            },
            "properties": {
                "name": "[variables('WebappDevelopName')]",
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms/', parameters('planName'))]"
            },
            "resources": [
               {
                "name": "appsettings",
                "type": "config",
                "apiVersion": "2015-08-01",
                "dependsOn": [
                    "[resourceId('Microsoft.Web/sites', variables('WebappDevelopName'))]",
                    "[resourceId('Microsoft.Insights/components', variables('appInsightsName'))]",
                    "Microsoft.ApplicationInsights.AzureWebSites"
                ],
                "properties": {
                    "APPINSIGHTS_INSTRUMENTATIONKEY": "[reference(resourceId('Microsoft.Insights/components', variables('appInsightsName')), '2014-04-01').InstrumentationKey]"
                }
            }
        ]
    }, 
    {
        "apiVersion": "2015-08-01",
        "name": "Microsoft.ApplicationInsights.AzureWebSites",
        "type": "siteextensions",
        "dependsOn": [
            "[resourceId('Microsoft.Web/Sites', variables('WebappDevelopName'))]"
        ],
        "properties": {}
    },     
    {
        "apiVersion": "2014-04-01",
        "name": "[variables('appInsightsName')]",
        "type": "Microsoft.Insights/components",
        "kind": "web",
        "location": "[resourceGroup().location]",
        "dependsOn": [
            "[resourceId('Microsoft.Web/sites/', variables('WebappDevelopName'))]"
        ],
        "tags": {
            "[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', variables('WebappDevelopName'))]": "Resource"
        },
        "properties": {
            "applicationId": "[variables('ase')]"
        }
    },
  
        {
            "name": "[variables('StoragetestName')]",
            "type": "Microsoft.Storage/storageAccounts",
            "location": "[resourceGroup().location]",
            "apiVersion": "2015-06-15",
            "dependsOn": [],
            "tags": {
                "displayName": "Storage"
            },
            "properties": {
                "accountType": "[parameters('stType')]"
            }
        }
    ],
    "variables": {
        "WebappDevelopName": "[concat(parameters('ase'), uniqueString(resourceGroup().id))]",
        "StoragetestName": "[concat(parameters('st'), uniqueString(resourceGroup().id))]",
        "appInsightsName": "[concat(parameters('appi'), uniqueString(resourceGroup().id))]"   
    }
}